@using TechnicalTest.Models
@model FileUploadViewModel
@{
    ViewBag.Title = "View Uploaded Result";
    Layout = "~/Views/Shared/AdminLayout.cshtml";

    string viewMode = String.Empty;
}
<div class="main-content">
    <div class="main-content-inner">
        <div class="breadcrumbs ace-save-state" id="breadcrumbs">
            <ul class="breadcrumb">
                <li>
                    <i class="ace-icon fa fa-home home-icon"></i>
                    <a href="#">Home</a>
                </li>

                <li>
                    <a href="/Assignment/XMLAssignment">XML Assignment</a>
                </li>
                <li>
                    <a href="/Assignment/CSVAssignment">CSV Assignment</a>
                </li>
                <li class="active">Upload</li>
            </ul><!-- /.breadcrumb -->
        </div>

        <div class="page-content" style="font-family:Zawgyi-One;">         
            <!-- PAGE CONTENT BEGINS -->            
            <div class="form-horizontal">
                <div class="form-group">
                    <label class="control-label col-md-2" for="XMLFileLocation">Currency Code</label>
                    <div class="col-md-4">
                        <div class="input-group">
                            <input class="form-control" type="text" id="searchcode" />
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-md-2" for="XMLFileLocation">Status</label>
                    <div class="col-md-4">
                        <div class="input-group">
                            <input class="form-control" type="text" id="searchstatus" />
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-md-2" for="XMLFileLocation">From Date</label>
                    <div class="col-md-4">
                        <div class="input-group">
                            <input class="form-control date-picker" name="fromdate" id="fromdate" type="text" data-date-format="dd-mm-yyyy" />
                            <span class="input-group-addon">
                                <i class="fa fa-calendar bigger-110"></i>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-md-2" for="XMLFileLocation">To Date</label>
                    <div class="col-md-4">
                        <div class="input-group">
                            <input class="form-control date-picker" name="fromdate" id="todate" type="text" data-date-format="dd-mm-yyyy" />
                            <span class="input-group-addon">
                                <i class="fa fa-calendar bigger-110"></i>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-md-offset-2 col-md-10">
                        <a href="#" class="btn btn-default" id="btnsearch">Search</a>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12">
                    <table id="assignmenttable" class="table  table-bordered table-hover">
                        <thead>
                            <tr>
                                <th>Transaction ID</th>
                                <th>Payment</th>
                                <th>Status</th>
                            </tr>
                        </thead>

                        <tbody>
                            <tr>
                                <td colspan="3">No data found</td>
                            </tr>
                        </tbody>
                    </table>
                </div><!-- /.span -->
            </div><!-- /.row -->
        </div>
    </div>
</div>

@section Scripts {
    <!-- basic scripts -->
    <!--[if !IE]> -->
    <script src="/assets/js/jquery-2.1.4.min.js"></script>
    @Scripts.Render("~/bundles/jqueryval")

    <!-- <![endif]-->
    <!--[if IE]> to use
    <script src="assets/js/jquery-1.11.3.min.js"></script>
    <![endif]-->
    <script type="text/javascript">
        if ('ontouchstart' in document.documentElement) document.write("<script src='/assets/js/jquery.mobile.custom.min.js'>" + "<" + "/script>");
    </script>
    <script src="/assets/js/bootstrap.min.js"></script>

    <!-- page specific plugin scripts -->
    <!--[if lte IE 8]>
      <script src="assets/js/excanvas.min.js"></script>
    <![endif]-->
    <script src="/assets/js/jquery-ui.custom.min.js"></script>
    <script src="/assets/js/jquery.ui.touch-punch.min.js"></script>
    <script src="/assets/js/chosen.jquery.min.js"></script>
    <script src="/assets/js/spinbox.min.js"></script>
    <script src="/assets/js/bootstrap-datepicker.min.js"></script>
    <script src="/assets/js/bootstrap-timepicker.min.js"></script>
    <script src="/assets/js/moment.min.js"></script>
    <script src="/assets/js/daterangepicker.min.js"></script>
    <script src="/assets/js/bootstrap-datetimepicker.min.js"></script>
    <script src="/assets/js/bootstrap-colorpicker.min.js"></script>
    <script src="/assets/js/jquery.knob.min.js"></script>
    <script src="/assets/js/autosize.min.js"></script>
    <script src="/assets/js/jquery.inputlimiter.min.js"></script>
    <script src="/assets/js/jquery.maskedinput.min.js"></script>
    <script src="/assets/js/bootstrap-tag.min.js"></script>

    <script src="/Scripts/summernote.js"></script>
    <script src="/Scripts/script-custom-editor.js"></script>
    <link href="/css/summernote.css" rel="stylesheet" />

    <!-- ace scripts -->
    <script src="/assets/js/ace-elements.min.js"></script>
    <script src="/assets/js/ace.min.js"></script>
    <script type="text/javascript">
        jQuery(function ($) {
            $('.date-picker').datepicker({
                autoclose: true,
                todayHighlight: true
            })
                //show datepicker when clicking on the icon
                .next().on(ace.click_event, function () {
                    $(this).prev().focus();
                });
            $("#btnsearch").click(function () {
                LoadGridData();   
            });
            LoadGridData();           
            function LoadGridData() {
                $.ajax
                    ({
                        url: '/Assignment/GetUploadedData',
                        type: 'POST',
                        datatype: 'application/json',
                        contentType: 'application/json',
                        data: JSON.stringify({
                            curCode: $("#searchcode").val(),
                            status: $("#searchstatus").val(),
                            fromdate: $("#fromdate").val(),
                            todate: $("#todate").val()
                        }),
                        success: function (result) {
                            var table = $('#assignmenttable');
                            table.find("tbody tr").remove();

                            $.each($.parseJSON(result), function (i, apidataresult) {
                                for (var j = 0; j < apidataresult.PaymentDetailInfo.length; j++) {                                  
                                    if (apidataresult.Status == "Approved") {
                                        table.append("<tr><td>" + apidataresult.Id + "</td>"
                                            + "<td>" + apidataresult.PaymentDetailInfo[j].Amount + " (" + apidataresult.PaymentDetailInfo[j].CurrencyCode + ")</td>"
                                            + "<td>A</td>"
                                            + "</tr>");
                                    }
                                    else if (apidataresult.Status == "Failed" || apidataresult.Status == "Rejected") {
                                        table.append("<tr><td>" + apidataresult.Id + "</td>"
                                            + "<td>" + apidataresult.PaymentDetailInfo[j].Amount + " (" + apidataresult.PaymentDetailInfo[j].CurrencyCode + ")</td>"
                                            + "<td>R</td>"
                                            + "</tr>");
                                    }
                                    else if (apidataresult.Status == "Finished" || apidataresult.Status == "Done") {
                                        table.append("<tr><td>" + apidataresult.Id + "</td>"
                                            + "<td>" + apidataresult.PaymentDetailInfo[j].Amount + " (" + apidataresult.PaymentDetailInfo[j].CurrencyCode + ")</td>"
                                            + "<td>D</td>"
                                            + "</tr>");
                                    }
                                    else if (apidataresult.Status == "Finished" || apidataresult.Status == "Done") {
                                        table.append("<tr><td>" + apidataresult.Id + "</td>"
                                            + "<td>" + apidataresult.PaymentDetailInfo[j].Amount + " (" + apidataresult.PaymentDetailInfo[j].CurrencyCode + ")</td>"
                                            + "<td>" + apidataresult.Status + "</td>"
                                            + "</tr>");
                                    }
                                }
                            })
                        },
                        error: function () {
                            alert("Whooaaa! Something went wrong..")
                        },
                    });
            }
        });
    </script>


}
